
{% extends 'master.html' %}
{% block title %} <title>Data Management - Lab Lynx</title> {% endblock %}

{% block content %}
<main class="container mt-4">
    <h2>Data Management Center</h2>
    
    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs" id="dataTabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#samples">Samples</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#testResults">Test Results</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#labels">Labels</a>
        </li>
    </ul>

    <div class="tab-content mt-3">
        <!-- Samples Tab -->
        <div id="samples" class="tab-pane fade show active">
            <h3>Submitted Samples</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Sample ID</th>
                        <th>Batch No.</th>
                        <th>Type</th>
                        <th>Origin</th>
                        <th>Status</th>
                        <th>Submitted By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sample in samples %}
                    <tr>
                        <td>{{ sample.sample_id }}</td>
                        <td>{{ sample.batch_number }}</td>
                        <td>{{ sample.sample_type }}</td>
                        <td>{{ sample.sample_origin }}</td>
                        <td>{{ sample.testing_status }}</td>
                        <td>{{ sample.submitted_by.username }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No samples found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Test Results Tab -->
        <div id="testResults" class="tab-pane fade">
            <h3>Test Results</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Test ID</th>
                        <th>Sample ID</th>
                        <th>Quality Analysis</th>
                        <th>Compliance</th>
                        <th>Test Date</th>
                        <th>Conducted By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in test_results %}
                    <tr>
                        <td>{{ result.id }}</td>
                        <td>{{ result.sample.sample_id }}</td>
                        <td>{{ result.quality_analysis }}</td>
                        <td>
                            {% if result.compliance_status %}
                                <span class="badge bg-success">Compliant</span>
                            {% else %}
                                <span class="badge bg-danger">Non-Compliant</span>
                            {% endif %}
                        </td>
                        <td>{{ result.test_date }}</td>
                        <td>{{ result.conducted_by.username }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No test results found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Labels Tab -->
        <div id="labels" class="tab-pane fade">
            <h3>Generated Labels</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Label ID</th>
                        <th>Sample ID</th>
                        <th>Generated Date</th>
                        <th>Expiry Date</th>
                        <th>Certification No.</th>
                        <th>Generated By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for label in labels %}
                    <tr>
                        <td>{{ label.id }}</td>
                        <td>{{ label.sample.sample_id }}</td>
                        <td>{{ label.generated_date }}</td>
                        <td>{{ label.expiry_date }}</td>
                        <td>{{ label.certification_number }}</td>
                        <td>{{ label.generated_by.username }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No labels found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <a href="{% url 'export_data_csv' %}" class="btn btn-primary mt-3">Export Data as CSV</a>
</main>
{% endblock %}
